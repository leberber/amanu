<!-- Header Container -->
<div class="fixed top-0 left-0 w-full surface-card z-5 header-height pt-2">
  <div class="h-full px-2">
    
    <!-- Desktop Layout -->
    <div class="hidden lg:flex h-full justify-content-between align-items-center">
      <ng-container *ngTemplateOutlet="desktopLogo"></ng-container>
      <ng-container *ngTemplateOutlet="desktopActions"></ng-container>
    </div>

    <!-- Mobile Layout -->
    <div class="flex lg:hidden h-full justify-content-between align-items-center">
      <ng-container *ngTemplateOutlet="mobileLogo"></ng-container>
      <ng-container *ngTemplateOutlet="mobileActions"></ng-container>
    </div>
    
  </div>
</div>

<!-- Mobile Drawer -->
<p-drawer 
  [(visible)]="menuVisible"
  position="full"
  [showCloseIcon]="true"
  [modal]="false"
  styleClass="p-0">
  
  <ng-template pTemplate="header">
    <ng-container *ngTemplateOutlet="drawerHeader"></ng-container>
  </ng-template>
  
  <ng-container *ngTemplateOutlet="drawerContent"></ng-container>
</p-drawer>

<!-- ===================== TEMPLATE DEFINITIONS ===================== -->

<!-- Desktop Logo Template -->
<ng-template #desktopLogo>
  <div class="flex align-items-center">
    <a routerLink="/" class="mr-4">
      <img src="/logo.png" alt="Elsuq" class="h-3rem">
    </a>
    <p-menubar 
      [model]="items()" 
      styleClass="border-none bg-transparent">
    </p-menubar>
  </div>
</ng-template>

<!-- Desktop Actions Template -->
<ng-template #desktopActions>
  <div class="flex align-items-center gap-2">
    <a *ngIf="cartCount()" routerLink="/cart" class="flex align-items-center gap-1 text-color">
      <p-overlayBadge [value]="cartCount()" severity="danger">
        <i class="pi pi-shopping-cart text-xl"></i>
      </p-overlayBadge>
      <span class="ml-1">{{ 'common.cart' | translate }}</span>
    </a>
    
    <ng-container *ngIf="authService.isLoggedIn; else loginButtons">
      <ng-container *ngTemplateOutlet="userMenu"></ng-container>
    </ng-container>
    
    <ng-template #loginButtons>
      <p-button 
        [label]="'common.login' | translate" 
        icon="pi pi-sign-in"
        styleClass="p-button-text" 
        routerLink="/login">
      </p-button>
      <p-button 
        [label]="'common.register' | translate" 
        icon="pi pi-user-plus"
        routerLink="/register">
      </p-button>
    </ng-template>
  </div>
</ng-template>

<!-- Mobile Logo Template -->
<ng-template #mobileLogo>
  <a routerLink="/">
    <img src="/logo.png" alt="Elsuq" class="h-2rem">
  </a>
</ng-template>

<!-- Mobile Actions Template -->
<ng-template #mobileActions>
  <div class="flex align-items-center gap-2">
    <a *ngIf="cartCount()" routerLink="/cart" class="button-icon-large">
      <p-overlayBadge [value]="cartCount()" severity="danger">
        <i class="pi pi-shopping-cart"></i>
      </p-overlayBadge>
    </a>
    
    <button 
      pButton 
      icon="pi pi-bars"
      class="p-button-text p-button-rounded button-icon-large"
      (click)="toggleMobileMenu()">
    </button>
  </div>
</ng-template>

<!-- User Menu Template -->
<ng-template #userMenu>
  <p-menu #menu [model]="userMenuItems()" [popup]="true">
    <ng-template pTemplate="start">
      <div class="p-3 border-bottom-1 surface-border">
        <app-language-selector></app-language-selector>
      </div>
    </ng-template>
  </p-menu>
  <button 
    type="button" 
    class="user-menu-btn flex align-items-center"
    (click)="menu.toggle($event)">
    <p-avatar 
      [label]="userInitials()" 
      shape="circle" 
      styleClass="user-avatar">
    </p-avatar>
  </button>
</ng-template>

<!-- Drawer Header Template -->
<ng-template #drawerHeader>
  <div class="flex align-items-center justify-content-between p-3">
    <a routerLink="/" (click)="closeMenu()">
      <img src="/logo.png" alt="Elsuq" class="h-2rem">
    </a>
  </div>
</ng-template>

<!-- Drawer Content Template -->
<ng-template #drawerContent>
  <div class="flex flex-column h-full">
    <!-- Language Selector -->
    <div class="p-3 border-bottom-1 surface-border">
      <app-language-selector></app-language-selector>
    </div>
    
    <!-- Navigation Items -->
    <div class="flex-grow-1 overflow-y-auto">
      <nav class="p-3">
        <a 
          *ngFor="let item of mobileItems()"
          [routerLink]="item.routerLink" 
          (click)="closeMenu()"
          [class]="getMobileLinkClass()">
          <i [class]="item.icon + ' mr-3'"></i>
          <span>{{ item.label }}</span>
        </a>
      </nav>
    </div>

    <!-- User Section -->
    <div class="mt-auto border-top-1 surface-border">
      <ng-container *ngIf="authService.isLoggedIn; else mobileLogin">
        <ng-container *ngTemplateOutlet="mobileUserSection"></ng-container>
      </ng-container>
      
      <ng-template #mobileLogin>
        <ng-container *ngTemplateOutlet="mobileLoginSection"></ng-container>
      </ng-template>
    </div>
  </div>
</ng-template>

<!-- Mobile User Section Template -->
<ng-template #mobileUserSection>
  <div class="p-3">
    <div class="flex align-items-center gap-3 mb-3">
      <p-avatar 
        [label]="userInitials()" 
        shape="circle" 
        size="large"
        styleClass="user-avatar">
      </p-avatar>
      <div class="flex-1">
        <div class="font-semibold">{{ displayName() }}</div>
        <div class="text-sm text-500">{{ userEmail() }}</div>
      </div>
    </div>
    
    <div class="flex flex-column gap-2">
      <button 
        *ngFor="let item of getMobileUserActions()"
        pButton 
        [label]="item.label || ''"
        [icon]="item.icon || ''"
        [class]="'w-full p-button-text justify-content-start ' + (item.styleClass || '')"
        [routerLink]="item.routerLink"
        (click)="closeMenu()">
      </button>
      <div class="my-2 border-top-1 surface-border"></div>
      <button 
        pButton 
        [label]="'common.logout' | translate"
        icon="pi pi-sign-out"
        class="w-full p-button-danger p-button-text justify-content-start"
        (click)="logout()">
      </button>
    </div>
  </div>
</ng-template>

<!-- Mobile Login Section Template -->
<ng-template #mobileLoginSection>
  <div class="p-3">
    <div class="text-center mb-3">
      <i class="pi pi-user-plus text-5xl text-300"></i>
      <h3 class="mt-3 mb-1">{{ 'auth.welcome' | translate }}</h3>
      <p class="text-500 mb-0">{{ 'auth.signInMessage' | translate }}</p>
    </div>
    
    <div class="flex flex-column gap-2">
      <button 
        pButton 
        [label]="'common.login' | translate"
        icon="pi pi-sign-in"
        class="w-full"
        routerLink="/login"
        (click)="closeMenu()">
      </button>
      <button 
        pButton 
        [label]="'common.register' | translate"
        icon="pi pi-user-plus"
        class="w-full p-button-outlined"
        routerLink="/register"
        (click)="closeMenu()">
      </button>
    </div>
  </div>
</ng-template>