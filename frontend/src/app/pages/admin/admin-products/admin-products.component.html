<!-- frontend/src/app/pages/admin/admin-products/admin-products.component.html -->
<div class="h-full pt-2 px-2">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
  
  <!-- Header -->
  <div class="flex justify-content-between align-items-center mb-4">
    <h1 class="text-3xl font-medium m-0">Product Management</h1>
    <p-button 
      label="Add New Product" 
      icon="pi pi-plus"
      severity="success"
      (onClick)="createNewProduct()"
    />
  </div>

  <!-- Filters Card -->
  <p-card styleClass="mb-4">
    <ng-template pTemplate="header">
      <div class="flex align-items-center gap-2">
        <i class="pi pi-filter"></i>
        <span class="font-medium">Filters</span>
      </div>
    </ng-template>
    
    <div class="grid">
      <!-- Search -->
      <div class="col-12 md:col-4">
        <label for="search" class="block font-medium mb-2">Search Products</label>
        <div class="p-inputgroup">
          <input 
            id="search"
            type="text" 
            pInputText 
            [(ngModel)]="searchQuery"
            placeholder="Search by name or description..."
            (keyup.enter)="onSearch()"
            class="w-full"
          />
          <button 
            pButton 
            icon="pi pi-search"
            (onClick)="onSearch()"
            class="p-button-outlined"
          ></button>
        </div>
      </div>

      <!-- Category Filter -->
      <div class="col-12 md:col-3">
        <label for="category" class="block font-medium mb-2">Category</label>
        <p-select
          id="category"
          [(ngModel)]="selectedCategory"
          [options]="categoryOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="All Categories"
          (onChange)="onCategoryChange()"
          styleClass="w-full"
        />
      </div>

      <!-- Actions -->
      <div class="col-12 md:col-5">
        <label class="block font-medium mb-2">&nbsp;</label>
        <div class="flex gap-2">
          <p-button 
            label="Clear Filters" 
            icon="pi pi-filter-slash"
            severity="secondary"
            (onClick)="clearFilters()"
          />
        </div>
      </div>
    </div>
  </p-card>

  <!-- Products Table -->
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex justify-content-between align-items-center">
        <span class="font-medium text-lg">All Products ({{ products.length }})</span>
        <div class="flex align-items-center gap-2">
          <i class="pi pi-box text-color-secondary"></i>
          <span class="text-color-secondary">Total: {{ products.length }}</span>
        </div>
      </div>
    </ng-template>

    <p-table 
      [value]="products" 
      [loading]="loading"
      responsiveLayout="scroll"
      [scrollable]="true"
      scrollHeight="600px"
      styleClass="p-datatable-sm"
    >
      <!-- Product Name & Image -->
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 200px">Product</th>
          <th style="width: 120px">Category</th>
          <th style="width: 100px">Price</th>
          <th style="width: 80px">Stock</th>
          <th style="width: 80px">Unit</th>
          <th style="width: 100px">Status</th>
          <th style="width: 120px">Created</th>
          <th style="width: 150px">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-product>
        <tr>
          <!-- Product Info -->
          <td>
            <div class="flex align-items-center gap-3">
              <div 
                class="w-3rem h-3rem bg-gray-100 border-round flex align-items-center justify-content-center overflow-hidden"
              >
                <img 
                  *ngIf="product.image_url" 
                  [src]="product.image_url" 
                  [alt]="product.name"
                  class="w-full h-full object-cover"
                 
                />
                <i 
                  *ngIf="!product.image_url" 
                  class="pi pi-image text-gray-400 text-xl"
                ></i>
              </div>
              <div>
                <div class="font-medium">{{ product.name }}</div>
                <div 
                  *ngIf="product.description" 
                  class="text-sm text-color-secondary line-height-2"
                  [title]="product.description"
                >
                  {{ product.description.length > 50 ? (product.description | slice:0:50) + '...' : product.description }}
                </div>
                <div *ngIf="product.is_organic" class="mt-1">
                  <p-tag value="Organic" severity="success" styleClass="text-xs" />
                </div>
              </div>
            </div>
          </td>

          <!-- Category -->
          <td>
            <span class="font-medium">{{ getCategoryName(product.category_id) }}</span>
          </td>

          <!-- Price -->
          <td>
            <span class="font-bold text-primary">${{ product.price | number:'1.2-2' }}</span>
          </td>

          <!-- Stock -->
          <td>
            <p-tag 
              [value]="getStockLabel(product.stock_quantity)"
              [severity]="getStockSeverity(product.stock_quantity)"
            />
            <div class="text-sm text-color-secondary mt-1">
              {{ product.stock_quantity }} {{ getUnitDisplay(product.unit) }}
            </div>
          </td>

          <!-- Unit -->
          <td>
            <span>{{ getUnitDisplay(product.unit) }}</span>
          </td>

          <!-- Status -->
          <td>
            <p-tag 
              [value]="product.is_active ? 'Active' : 'Inactive'"
              [severity]="product.is_active ? 'success' : 'danger'"
            />
          </td>

          <!-- Created Date -->
          <td>
            <span class="text-sm">{{ formatDate(product.created_at) }}</span>
          </td>

          <!-- Actions -->
          <td>
            <div class="flex gap-1">
              <!-- View Product -->
              <p-button 
                icon="pi pi-eye"
                severity="info"
                [text]="true"
                [rounded]="true"
                size="small"
                (onClick)="viewProduct(product)"
                pTooltip="View Product"
                tooltipPosition="top"
              />
              
              <!-- Edit Product -->
              <p-button 
                icon="pi pi-pencil"
         
                [text]="true"
                [rounded]="true"
                size="small"
                (onClick)="editProduct(product)"
                pTooltip="Edit Product"
                tooltipPosition="top"
              />
              
              <!-- Delete Product -->
              <p-button 
                icon="pi pi-trash"
                severity="danger"
                [text]="true"
                [rounded]="true"
                size="small"
                (onClick)="confirmDeleteProduct(product)"
                pTooltip="Delete Product"
                tooltipPosition="top"
              />
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty State -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">
            <div class="text-center py-6">
              <i class="pi pi-box text-6xl text-color-secondary mb-3"></i>
              <div class="text-xl font-medium mb-2">No products found</div>
              <div class="text-color-secondary mb-4">
                {{ searchQuery || selectedCategory ? 'Try adjusting your filters' : 'Get started by adding your first product' }}
              </div>
              <p-button 
                *ngIf="!searchQuery && !selectedCategory"
                label="Add First Product" 
                icon="pi pi-plus"
                (onClick)="createNewProduct()"
              />
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>