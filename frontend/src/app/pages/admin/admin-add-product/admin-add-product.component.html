<!-- src/app/pages/admin/admin-add-product/admin-add-product.component.html -->
<div class="content-height p-4">
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex justify-content-between align-items-center p-4">
        <h2 class="m-0">{{ pageTitle }}</h2>
        <p-button 
          icon="pi pi-arrow-left" 
          label="Cancel" 
          severity="secondary" 
          (onClick)="onCancel()"
        />
      </div>
    </ng-template>

    <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="p-4">
      
      <!-- 🆕 UPDATED: Product Names Section (No Primary Field) -->
      <div class="section-title">
        <i class="pi pi-globe mr-2"></i>Product Names *
      </div>
      <p class="text-sm text-color-secondary mb-3">
        Provide the product name in all supported languages. English will be used as the primary name.
      </p>

      <!-- English Name (Primary) -->
      <div class="language-section">
        <div class="flex align-items-center mb-2">
          <span class="language-flag">🇬🇧</span>
          <strong>English Name (Primary) *</strong>
        </div>
        <div class="field">
          <input 
            type="text" 
            id="name_en"
            pInputText 
            formControlName="name_en" 
            placeholder="Enter product name in English"
            class="w-full"
            [class.ng-invalid]="productForm.get('name_en')?.invalid && productForm.get('name_en')?.touched"
          />
          <small 
            *ngIf="productForm.get('name_en')?.invalid && productForm.get('name_en')?.touched" 
            class="p-error"
          >
            <span *ngIf="productForm.get('name_en')?.errors?.['required']">
              English name is required
            </span>
            <span *ngIf="productForm.get('name_en')?.errors?.['minlength']">
              English name must be at least 1 character
            </span>
          </small>
        </div>
      </div>

      <!-- French Name -->
      <div class="language-section">
        <div class="flex align-items-center mb-2">
          <span class="language-flag">🇫🇷</span>
          <strong>French Name (Nom en Français) *</strong>
        </div>
        <div class="field">
          <input 
            type="text" 
            id="name_fr"
            pInputText 
            formControlName="name_fr" 
            placeholder="Entrez le nom du produit en français"
            class="w-full"
            [class.ng-invalid]="productForm.get('name_fr')?.invalid && productForm.get('name_fr')?.touched"
          />
          <small 
            *ngIf="productForm.get('name_fr')?.invalid && productForm.get('name_fr')?.touched" 
            class="p-error"
          >
            <span *ngIf="productForm.get('name_fr')?.errors?.['required']">
              French name is required
            </span>
            <span *ngIf="productForm.get('name_fr')?.errors?.['minlength']">
              French name must be at least 1 character
            </span>
          </small>
        </div>
      </div>

      <!-- Arabic Name -->
      <div class="language-section">
        <div class="flex align-items-center mb-2">
          <span class="language-flag">🇩🇿</span>
          <strong>Arabic Name (الاسم بالعربية) *</strong>
        </div>
        <div class="field">
          <input 
            type="text" 
            id="name_ar"
            pInputText 
            formControlName="name_ar" 
            placeholder="أدخل اسم المنتج بالعربية"
            class="w-full"
            dir="rtl"
            [class.ng-invalid]="productForm.get('name_ar')?.invalid && productForm.get('name_ar')?.touched"
          />
          <small 
            *ngIf="productForm.get('name_ar')?.invalid && productForm.get('name_ar')?.touched" 
            class="p-error"
          >
            <span *ngIf="productForm.get('name_ar')?.errors?.['required']">
              Arabic name is required
            </span>
            <span *ngIf="productForm.get('name_ar')?.errors?.['minlength']">
              Arabic name must be at least 1 character
            </span>
          </small>
        </div>
      </div>

      <!-- 🆕 UPDATED: Product Descriptions Section -->
      <div class="section-title">
        <i class="pi pi-file-text mr-2"></i>Product Descriptions
      </div>
      <p class="text-sm text-color-secondary mb-3">
        Provide detailed descriptions in all supported languages (optional).
      </p>

      <!-- English Description -->
      <div class="language-section">
        <div class="flex align-items-center mb-2">
          <span class="language-flag">🇬🇧</span>
          <strong>English Description</strong>
        </div>
        <div class="field">
          <textarea 
            id="description_en"
            pTextarea 
            formControlName="description_en" 
            placeholder="Enter product description in English"
            class="w-full"
            rows="3"
          ></textarea>
        </div>
      </div>

      <!-- French Description -->
      <div class="language-section">
        <div class="flex align-items-center mb-2">
          <span class="language-flag">🇫🇷</span>
          <strong>French Description (Description en Français)</strong>
        </div>
        <div class="field">
          <textarea 
            id="description_fr"
            pTextarea 
            formControlName="description_fr" 
            placeholder="Entrez la description du produit en français"
            class="w-full"
            rows="3"
          ></textarea>
        </div>
      </div>

      <!-- Arabic Description -->
      <div class="language-section">
        <div class="flex align-items-center mb-2">
          <span class="language-flag">🇩🇿</span>
          <strong>Arabic Description (الوصف بالعربية)</strong>
        </div>
        <div class="field">
          <textarea 
            id="description_ar"
            pTextarea 
            formControlName="description_ar" 
            placeholder="أدخل وصف المنتج بالعربية"
            class="w-full"
            rows="3"
            dir="rtl"
          ></textarea>
        </div>
      </div>

      <!-- Pricing & Inventory Section -->
      <div class="section-title">
        <i class="pi pi-dollar mr-2"></i>Pricing & Inventory
      </div>

      <div class="grid">
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="price">Price *</label>
            <p-inputNumber
              id="price"
              formControlName="price"
              mode="currency"
              currency="EUR"
              locale="fr-FR"
              class="w-full"
              [class.ng-invalid]="productForm.get('price')?.invalid && productForm.get('price')?.touched"
            />
            <small 
              *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched" 
              class="p-error"
            >
              <span *ngIf="productForm.get('price')?.errors?.['required']">
                Price is required
              </span>
              <span *ngIf="productForm.get('price')?.errors?.['min']">
                Price must be greater than 0
              </span>
            </small>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="unit">Unit *</label>
            <p-select
              id="unit"
              formControlName="unit"
              [options]="unitOptions"
              placeholder="Select unit"
              class="w-full"
              [class.ng-invalid]="productForm.get('unit')?.invalid && productForm.get('unit')?.touched"
            />
            <small 
              *ngIf="productForm.get('unit')?.invalid && productForm.get('unit')?.touched" 
              class="p-error"
            >
              Unit is required
            </small>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="stock_quantity">Stock Quantity *</label>
            <p-inputNumber
              id="stock_quantity"
              formControlName="stock_quantity"
              [min]="0"
              class="w-full"
              [class.ng-invalid]="productForm.get('stock_quantity')?.invalid && productForm.get('stock_quantity')?.touched"
            />
            <small 
              *ngIf="productForm.get('stock_quantity')?.invalid && productForm.get('stock_quantity')?.touched" 
              class="p-error"
            >
              <span *ngIf="productForm.get('stock_quantity')?.errors?.['required']">
                Stock quantity is required
              </span>
              <span *ngIf="productForm.get('stock_quantity')?.errors?.['min']">
                Stock quantity cannot be negative
              </span>
            </small>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="category_id">Category *</label>
            <p-select
              id="category_id"
              formControlName="category_id"
              [options]="categoryOptions()"
              placeholder="Select category"
              class="w-full"
              [loading]="categoriesLoading()"
              [class.ng-invalid]="productForm.get('category_id')?.invalid && productForm.get('category_id')?.touched"
            />
            <small 
              *ngIf="productForm.get('category_id')?.invalid && productForm.get('category_id')?.touched" 
              class="p-error"
            >
              Category is required
            </small>
          </div>
        </div>
      </div>

      <!-- Settings Section -->
      <div class="section-title">
        <i class="pi pi-cog mr-2"></i>Settings
      </div>

      <div class="grid">
        <div class="col-12">
          <div class="field">
            <label for="image_url">Image URL</label>
            <input 
              type="url" 
              id="image_url"
              pInputText 
              formControlName="image_url" 
              placeholder="Enter product image URL (e.g., https://example.com/image.jpg)"
              class="w-full"
            />
            <small class="text-color-secondary">
              Optional: Provide a URL to an image for this product
            </small>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field-checkbox">
            <p-checkbox 
              id="is_organic" 
              formControlName="is_organic" 
              binary="true"
            />
            <label for="is_organic" class="ml-2">Organic Product</label>
            <small class="block text-color-secondary mt-1">
              Check if this product is organically grown
            </small>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field-checkbox">
            <p-checkbox 
              id="is_active" 
              formControlName="is_active" 
              binary="true"
            />
            <label for="is_active" class="ml-2">Active Product</label>
            <small class="block text-color-secondary mt-1">
              Uncheck to hide this product from customers
            </small>
          </div>
        </div>
      </div>

      <!-- Translation Help Text -->
      <div class="mt-4 p-3 surface-100 border-round">
        <div class="flex align-items-start">
          <i class="pi pi-info-circle text-blue-500 mr-2 mt-1"></i>
          <div>
            <strong class="text-blue-500">Translation Guidelines:</strong>
            <ul class="mt-2 mb-0 text-sm text-color-secondary">
              <li>All language names are required to ensure consistent multilingual support</li>
              <li>English will be used as the primary name in the database</li>
              <li>Descriptions are optional but recommended for better product information</li>
              <li>Use proper language-specific characters and formatting</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex justify-content-end gap-2 mt-4">
        <p-button 
          label="Cancel" 
          severity="secondary" 
          (onClick)="onCancel()"
          [disabled]="loading()"
          icon="pi pi-times"
        />
        <p-button 
          type="submit" 
          [label]="submitButtonLabel" 
          [loading]="loading()"
          [disabled]="productForm.invalid"
          icon="pi pi-check"
        />
      </div>

      <!-- Form Validation Summary (for debugging) -->
      <div *ngIf="productForm.invalid && productForm.touched" class="mt-4 p-3 surface-200 border-round">
        <div class="flex align-items-start">
          <i class="pi pi-exclamation-triangle text-orange-500 mr-2 mt-1"></i>
          <div>
            <strong class="text-orange-500">Please fix the following errors:</strong>
            <ul class="mt-2 mb-0 text-sm">
              <li *ngIf="productForm.get('name_en')?.invalid && productForm.get('name_en')?.touched">
                English name is required
              </li>
              <li *ngIf="productForm.get('name_fr')?.invalid && productForm.get('name_fr')?.touched">
                French name is required
              </li>
              <li *ngIf="productForm.get('name_ar')?.invalid && productForm.get('name_ar')?.touched">
                Arabic name is required
              </li>
              <li *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched">
                Valid price is required
              </li>
              <li *ngIf="productForm.get('unit')?.invalid && productForm.get('unit')?.touched">
                Unit selection is required
              </li>
              <li *ngIf="productForm.get('stock_quantity')?.invalid && productForm.get('stock_quantity')?.touched">
                Valid stock quantity is required
              </li>
              <li *ngIf="productForm.get('category_id')?.invalid && productForm.get('category_id')?.touched">
                Category selection is required
              </li>
            </ul>
          </div>
        </div>
      </div>
    </form>
  </p-card>

  <!-- Toast messages -->
  <p-toast />
</div>